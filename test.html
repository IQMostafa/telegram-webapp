<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Mini App — Init Data Viewer</title>
  <style>
    :root{
      --bg:#0f1720; --card:#0d1623; --line:#243244; --txt:#e6edf3; --muted:#9fb0c2; --accent:#2ea6ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font:14px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Arial}
    header{padding:14px 16px;border-bottom:1px solid var(--line);background:#132233;font-weight:600}
    main{padding:16px;display:grid;gap:14px;max-width:900px;margin:0 auto}
    .row{display:grid;gap:8px}
    .label{font-weight:600;color:var(--muted)}
    pre{margin:0;padding:12px;border:1px solid var(--line);border-radius:10px;background:var(--card);white-space:pre-wrap;word-break:break-word}
    .pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.04)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    button{padding:8px 12px;border:1px solid var(--line);border-radius:8px;background:#152235;color:var(--txt);cursor:pointer}
    button:hover{background:#162a44}
    a{color:var(--accent);text-decoration:none}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <header>Telegram Init Data Viewer</header>
  <main>
    <div class="row">
      <div class="label">Status</div>
      <div id="status" class="pill">Checking environment…</div>
    </div>

    <div class="row">
      <div class="label">Environment</div>
      <pre id="env">(empty)</pre>
    </div>

    <div class="row">
      <div class="label">Raw <code>initData</code></div>
      <div class="actions">
        <button id="copyRaw">Copy raw</button>
      </div>
      <pre id="raw">(empty)</pre>
    </div>

    <div class="row">
      <div class="label">Parsed <code>initDataUnsafe</code></div>
      <div class="actions">
        <button id="copyParsed">Copy JSON</button>
      </div>
      <pre id="parsed">(empty)</pre>
    </div>

    <div class="muted">
      Tip: Open this via an <strong>InlineKeyboardButton</strong> with <code>web_app=WebAppInfo(url)</code> to get real values.
    </div>
  </main>

  <script>
    // Helpers
    const $ = (id) => document.getElementById(id);
    const setText = (id, text) => { $(id).textContent = (text ?? '').toString(); };
    const setJSON = (id, obj) => { $(id).textContent = JSON.stringify(obj, null, 2); };
    const copy = async (text) => { try { await navigator.clipboard.writeText(text); alert('Copied!'); } catch(_) { alert('Copy failed'); } };

    window.addEventListener('DOMContentLoaded', () => {
      const tg = window.Telegram?.WebApp;

      // Wire copy buttons
      $('copyRaw').onclick = () => copy($('raw').textContent);
      $('copyParsed').onclick = () => copy($('parsed').textContent);

      try {
        if (!tg) {
          // Not inside Telegram Mini App container
          $('status').textContent = 'NOT in Telegram Mini App (browser mode)';
          setJSON('env', {
            where: 'browser',
            href: location.href,
            userAgent: navigator.userAgent
          });
          setText('raw', '');
          setJSON('parsed', {
            note: 'Open via Telegram bot inline/reply button with web_app to see real initData.'
          });
          return;
        }

        // Inside Telegram Mini App
        tg.ready?.();
        tg.expand?.();

        $('status').textContent = 'INSIDE Telegram Mini App ✅';

        // Show environment info from Telegram
        setJSON('env', {
          platform: tg.platform,                 // 'android' | 'ios' | 'tdesktop' | 'macos' | 'web'
          version: tg.version,
          colorScheme: tg.colorScheme,
          isExpanded: tg.isExpanded,
          viewportStableHeight: tg.viewportStableHeight
        });

        // Raw + parsed init data
        setText('raw', tg.initData || '');
        setJSON('parsed', tg.initDataUnsafe || {});

        // Optional: main button to close
        if (tg.MainButton) {
          tg.MainButton.setText('Close');
          tg.MainButton.onClick(() => tg.close?.());
          tg.MainButton.show();
        }
      } catch (err) {
        $('status').textContent = 'Error while initializing';
        setText('raw', (err && (err.stack || err.message)) || String(err));
      }
    });
  </script>
</body>
</html>
