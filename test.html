<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Init Data Viewer</title>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0f1720; color:#e6edf3; }
    header { padding:12px 16px; border-bottom:1px solid #263445; background:#132233; font-weight:600; }
    main { padding:16px; }
    pre { white-space:pre-wrap; word-break:break-word; background:#0d1623; border:1px solid #263445; border-radius:10px; padding:12px; margin:0 0 12px; }
    .muted { opacity:.75; font-size:.95rem; margin-bottom:12px; }
  </style>
</head>
<body>
  <header>Telegram Init Data</header>
  <main>
    <div class="muted" id="status">Loading…</div>
    <h3>Raw initData</h3>
    <pre id="raw">(empty)</pre>

    <h3>Parsed initDataUnsafe</h3>
    <pre id="parsed">(empty)</pre>
  </main>

  <script>
    // Small HTML escaper to keep <pre> safe
    const esc = s => String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

    window.addEventListener('DOMContentLoaded', () => {
      const rawEl = document.getElementById('raw');
      const parsedEl = document.getElementById('parsed');
      const statusEl = document.getElementById('status');

      const tg = window.Telegram?.WebApp;

      try {
        if (!tg) {
          statusEl.textContent = 'Not running inside Telegram — showing mock data.';
          const mockRaw = '';
          const mockParsed = {
            platform: 'browser',
            note: 'Open this page from a Telegram bot WebApp button to see real initData.'
          };
          rawEl.innerHTML = esc(mockRaw);
          parsedEl.innerHTML = esc(JSON.stringify(mockParsed, null, 2));
          return;
        }

        // Good practice: signal ready & expand
        tg.ready?.();
        tg.expand?.();

        // Read init data
        const raw = tg.initData || '';
        const parsed = tg.initDataUnsafe || {};

        statusEl.textContent = 'Running inside Telegram ✅';
        rawEl.innerHTML = esc(raw);
        parsedEl.innerHTML = esc(JSON.stringify(parsed, null, 2));

        // Optional: show a main button (nice for testing)
        if (tg.MainButton) {
          tg.MainButton.setText('OK, Close');
          tg.MainButton.onClick(() => tg.close && tg.close());
          tg.MainButton.show();
        }
      } catch (err) {
        statusEl.textContent = 'Error';
        rawEl.innerHTML = esc(err?.stack || err?.message || String(err));
      }
    });
  </script>
</body>
</html>
