<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Question Editor</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --deep-space: #03040a;
      --midnight-ocean: #0b2236;
      --abyssal-blue: #0b2b3a;
      --teal-depths: #1e686f;
      --aqua-marine: #2f808a;
      --navy-shadow: #0f2a3a;
      --deep-teal: #1f525d;
      --void-blue: #061521;
      --twilight-sea: #112f41;
      --ocean-floor: #163e50;
      --accent: #338090;
      --text: #e6f6ff;
      --text-muted: #9db7c6;
      --success: #36a46a;
      --danger: #ee6b6b;
      --border: rgba(150, 190, 210, 0.10);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    html, body {
      height: 100%;
    }
    
    body {
      background: radial-gradient(ellipse at top, var(--void-blue) 0%, var(--deep-space) 70%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.5;
    }
    
    .container {
      width: 100%;
      max-width: 100vw;
      flex: 1;
      overflow: auto;
    }
    
    .content {
      padding: 20px 12px;
      max-width: 920px;
      margin: 0 auto;
      padding-bottom: 100px;
    }
    
    .preview-section {
      background: var(--navy-shadow);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 16px;
      border: 1px solid var(--border);
      position: relative;
    }
    
    .preview-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--aqua-marine), var(--teal-depths));
    }
    
    .section-title {
      color: var(--text);
      margin-bottom: 14px;
      font-size: 1.12rem;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 10px;
    }
    
    .section-title i {
      background: linear-gradient(135deg, var(--teal-depths), var(--aqua-marine));
      color: var(--text);
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
    }
    
    .editable-group {
      margin-bottom: 14px;
    }
    
    .editable-label {
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 8px;
      display: block;
      font-size: 1.00rem;
      padding-left: 6px;
    }
    
    .editable-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 1.02rem;
      line-height: 1.4;
      background: rgba(8, 30, 42, 0.5);
      color: var(--text);
      resize: vertical;
      outline: none;
    }
    
    .editable-input:focus {
      border-color: rgba(56, 120, 134, 0.32);
    }
    
    .answers-list {
      list-style: none;
      margin: 12px 0;
      padding: 0;
    }
    
    .answer-item {
      padding: 10px 12px;
      margin-bottom: 10px;
      background: rgba(14, 38, 53, 0.7);
      border-radius: 10px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      border: 1px solid var(--border);
    }
    
    .answer-item.correct {
      border-left: 5px solid var(--success);
      background: rgba(22, 58, 72, 0.7);
    }
    
    .answer-number {
      width: 34px;
      min-height: 34px;
      border-radius: 9px;
      background: linear-gradient(135deg, var(--teal-depths), var(--aqua-marine));
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--text);
      flex-shrink: 0;
      padding: 6px;
    }
    
    .answer-input {
      flex: 1;
      background: transparent;
      border: none;
      padding: 6px 4px;
      font-size: 1.00rem;
      color: var(--text);
      outline: none;
      resize: none;
      min-height: 36px;
      max-height: 240px;
    }
    
    .answer-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
      margin-left: 6px;
    }
    
    .correct-toggle {
      width: 48px;
      height: 26px;
      background: rgba(20, 46, 64, 0.82);
      border-radius: 14px;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 3px;
    }
    
    .correct-toggle.active {
      background: var(--success);
    }
    
    .toggle-handle {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #f7fbff;
      transition: transform .14s ease;
    }
    
    .correct-toggle.active .toggle-handle {
      transform: translateX(22px);
      background: #ffffff;
    }
    
    .remove-answer {
      width: 38px;
      height: 38px;
      border-radius: 9px;
      background: transparent;
      border: 1px solid rgba(238, 107, 107, 0.12);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--danger);
      cursor: pointer;
      font-size: 0.98rem;
    }
    
    .add-answer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      background: rgba(34, 90, 100, 0.10);
      color: var(--accent);
      border: 2px dashed rgba(56, 120, 134, 0.20);
      cursor: pointer;
      font-weight: 600;
    }
    
    .info-bar {
      display: flex;
      justify-content: space-between;
      padding: 10px 12px;
      border-radius: 10px;
      margin-top: 14px;
      font-size: 0.95rem;
      color: var(--text-muted);
    }
    
    .floating-actions {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 10px;
      display: flex;
      justify-content: center;
      z-index: 1200;
      padding: 0 8px;
    }
    
    .floating-inner {
      width: 100%;
      max-width: 920px;
      display: flex;
      gap: 8px;
      padding: 0 6px;
    }
    
    .btn {
      flex: 1;
      padding: 12px 12px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border: none;
      cursor: pointer;
    }
    
    .btn-save {
      background: linear-gradient(135deg, var(--teal-depths), var(--aqua-marine));
      color: white;
    }
    
    .btn-exit {
      background: var(--navy-shadow);
      color: var(--text);
    }
    
    @media (max-width: 768px) {
      .content {
        padding: 16px 10px;
        padding-bottom: 120px;
      }
      
      .floating-inner {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="content">
      <div class="preview-section">
        <h2 class="section-title"><i class="fas fa-edit"></i> Edit Question</h2>

        <div class="editable-group">
          <label class="editable-label">Question:</label>
          <textarea id="questionInput" class="editable-input" rows="2">What is the process called when free radicals couple to form aporphine alkaloids?</textarea>
        </div>

        <div class="editable-group">
          <label class="editable-label">Answers:</label>
          <ul class="answers-list" id="answersList">
            <li class="answer-item">
              <span class="answer-number">1</span>
              <textarea class="answer-input" rows="1">Ortho-para coupling</textarea>
              <div class="answer-actions">
                <div class="correct-toggle"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>

            <li class="answer-item correct">
              <span class="answer-number">2</span>
              <textarea class="answer-input" rows="1">Electrostatic binding</textarea>
              <div class="answer-actions">
                <div class="correct-toggle active"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>

            <li class="answer-item">
              <span class="answer-number">3</span>
              <textarea class="answer-input" rows="1">Redox reaction</textarea>
              <div class="answer-actions">
                <div class="correct-toggle"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>

            <li class="answer-item">
              <span class="answer-number">4</span>
              <textarea class="answer-input" rows="1">Radical cyclization</textarea>
              <div class="answer-actions">
                <div class="correct-toggle"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>
          </ul>

          <div class="add-answer" id="addAnswerBtn"><i class="fas fa-plus-circle"></i> Add Answer</div>
        </div>

        <div class="editable-group">
          <label class="editable-label">Explanation:</label>
          <textarea id="explanationInput" class="editable-input" rows="2">Aporphine alkaloids arise from ortho- or para-couplings involving free radicals.</textarea>
        </div>
      </div>

      <div class="info-bar">
        <div class="info-item">Question Editor | MOSTAFA ABBAS FADHIL | contact: @al_kaabi33</div>
      </div>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const questionInput = document.getElementById('questionInput');
    const explanationInput = document.getElementById('explanationInput');
    const answersList = document.getElementById('answersList');
    const addAnswerBtn = document.getElementById('addAnswerBtn');
    const saveBtn = document.getElementById('saveBtn');
    const exitBtn = document.getElementById('exitBtn');
    
    // Auto-resize textareas
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 240) + 'px';
    }
    
    // ✅ Set question text
    function setQuestion(text) {
      questionInput.value = text;
      autoResize(questionInput);
    }

    // ✅ Get question text
    function getQuestion() {
      return questionInput.value.trim();
    }

    // ✅ Set explanation
    function setExplanation(text) {
      explanationInput.value = text;
      autoResize(explanationInput);
    }

    // ✅ Get explanation
    function getExplanation() {
      return explanationInput.value.trim();
    }

    // Create a new answer item
    function createAnswer(value = '', isCorrect = false) {
      const li = document.createElement('li');
      li.className = 'answer-item';
      if (isCorrect) li.classList.add('correct');
      
      const span = document.createElement('span');
      span.className = 'answer-number';
      
      const textarea = document.createElement('textarea');
      textarea.className = 'answer-input';
      textarea.rows = 1;
      textarea.value = value;
      
      const actions = document.createElement('div');
      actions.className = 'answer-actions';
      
      const toggle = document.createElement('div');
      toggle.className = 'correct-toggle' + (isCorrect ? ' active' : '');
      toggle.innerHTML = '<div class="toggle-handle"></div>';
      
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-answer';
      removeBtn.type = 'button';
      removeBtn.title = 'Remove answer';
      removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
      
      actions.appendChild(toggle);
      actions.appendChild(removeBtn);
      li.appendChild(span);
      li.appendChild(textarea);
      li.appendChild(actions);
      
      // Set up event listeners for the new answer
      textarea.addEventListener('input', () => autoResize(textarea));
      toggle.addEventListener('click', () => setCorrect(li));
      removeBtn.addEventListener('click', () => removeAnswer(li));
      
      autoResize(textarea);
      return li;
    }
    
    // Renumber all answers
    function renumberAnswers() {
      const items = answersList.children;
      for (let i = 0; i < items.length; i++) {
        const num = items[i].querySelector('.answer-number');
        num.textContent = i + 1;
      }
    }
    
    // Remove an answer
    function removeAnswer(answerItem) {
      answerItem.remove();
      renumberAnswers();
    }
    
    // Set correct answer
    function setCorrect(answerItem) {
      document.querySelectorAll('.answer-item').forEach(item => {
        item.classList.remove('correct');
        item.querySelector('.correct-toggle').classList.remove('active');
      });
      
      answerItem.classList.add('correct');
      answerItem.querySelector('.correct-toggle').classList.add('active');
    }

    // ✅ Get all answers
    function getAnswers() {
      const items = answersList.querySelectorAll('.answer-item');
      return Array.from(items).map(item => ({
        text: item.querySelector('.answer-input').value.trim(),
        correct: item.classList.contains('correct')
      }));
    }

    // ✅ Set answers
    function setAnswers(answerArray) {
      answersList.innerHTML = '';
      answerArray.forEach((ans, i) => {
        const newAnswer = createAnswer(ans.text, ans.correct);
        answersList.appendChild(newAnswer);
      });
      renumberAnswers();
    }
    
    // Add answer button event
    addAnswerBtn.addEventListener('click', () => {
      const newAnswer = createAnswer('');
      answersList.appendChild(newAnswer);
      renumberAnswers();
      newAnswer.querySelector('.answer-input').focus();
    });
    
    // Set up event listeners for existing answers
    answersList.querySelectorAll('.correct-toggle').forEach(toggle => {
      toggle.addEventListener('click', function() {
        setCorrect(this.closest('.answer-item'));
      });
    });
    
    answersList.querySelectorAll('.remove-answer').forEach(button => {
      button.addEventListener('click', function() {
        removeAnswer(this.closest('.answer-item'));
      });
    });
    
    answersList.querySelectorAll('.answer-input').forEach(textarea => {
      textarea.addEventListener('input', function() {
        autoResize(this);
      });
    });

    autoResize(questionInput);
    autoResize(explanationInput);
    
    // Save button event
    if (saveBtn) {
      saveBtn.addEventListener('click', () => {
        const data = {
          question: getQuestion(),
          explanation: getExplanation(),
          answers: getAnswers()
        };
        console.log('Saving...', data);
      });
    }
    
    // Exit button event
    if (exitBtn) {
      exitBtn.addEventListener('click', () => {
        console.log('Exiting editor');
      });
    }

    // ================================
    // ✅ Telegram WebApp Integration
    // ================================
    setQuestion("this is js")
    if (true) {
      const tg = window.Telegram.WebApp;

      // Get prefilled text from URL (?text=...)
      const urlParams = new URLSearchParams(window.location.search);
      const prefill = urlParams.get("text") || "";

      setQuestion(prefill);

      // Send button handler (you should add a button with id="sendBtn" in HTML)
      const sendBtn = document.getElementById("sendBtn");
      if (sendBtn) {
        sendBtn.onclick = () => {
          const payload = {
            question: getQuestion(),
            explanation: getExplanation(),
            answers: getAnswers()
          };
          tg.sendData(JSON.stringify(payload));
        };
      }

      tg.expand();
    }
  });
</script>

</body>
</html>