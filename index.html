<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Question Editor</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
  <h1>My Mini App</h1>

    <div id="data-display">
        </div>

    <br>

    <button id="send-button">Send Data to Bot</button>

  <div class="container">
    <div class="content">
      <div class="preview-section">
        <h2 class="section-title"><i class="fas fa-edit"></i> Edit Question</h2>

        <div class="editable-group">
          <label class="editable-label">Question:</label>
          <textarea id="questionInput" class="editable-input" rows="2">What is the process called when free radicals couple to form aporphine alkaloids?</textarea>
        </div>

        <div class="editable-group">
          <label class="editable-label">Answers:</label>
          <ul class="answers-list" id="answersList">
            <li class="answer-item">
              <span class="answer-number">1</span>
              <textarea class="answer-input" rows="1">Ortho-para coupling</textarea>
              <div class="answer-actions">
                <div class="correct-toggle"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>

            <li class="answer-item correct">
              <span class="answer-number">2</span>
              <textarea class="answer-input" rows="1">Electrostatic binding</textarea>
              <div class="answer-actions">
                <div class="correct-toggle active"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>

            <li class="answer-item">
              <span class="answer-number">3</span>
              <textarea class="answer-input" rows="1">Redox reaction</textarea>
              <div class="answer-actions">
                <div class="correct-toggle"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>

            <li class="answer-item">
              <span class="answer-number">4</span>
              <textarea class="answer-input" rows="1">Radical cyclization</textarea>
              <div class="answer-actions">
                <div class="correct-toggle"><div class="toggle-handle"></div></div>
                <button class="remove-answer" title="Remove answer"><i class="fas fa-trash"></i></button>
              </div>
            </li>
          </ul>

          <div class="add-answer" id="addAnswerBtn"><i class="fas fa-plus-circle"></i> Add Answer</div>
        </div>

        <div class="editable-group">
          <label class="editable-label">Explanation:</label>
          <textarea id="explanationInput" class="editable-input" rows="2">Aporphine alkaloids arise from ortho- or para-couplings involving free radicals.</textarea>
        </div>
      </div>

      <div class="info-bar">
        <div class="info-item">Question Editor | MOSTAFA ABBAS FADHIL | contact: @al_kaabi33</div>
      </div>
    </div>
  </div>

  <div class="floating-actions">
    <div class="floating-inner">
      <button id="saveBtn" class="btn btn-save"><i class="fas fa-save"></i> Save Changes</button>
      <button id="exitBtn" class="btn btn-exit"><i class="fas fa-sign-out-alt"></i> Exit Editor</button>
    </div>
  </div>
    <script>
        // This function runs when the page is fully loaded
        window.onload = function() {
            // Get the Telegram Web App object
            const tg = window.Telegram.WebApp;
            tg.ready(); // Inform the Telegram client that the app is ready

            const displayDiv = document.getElementById('data-display');
            
            // --- 1. RECEIVING DATA FROM THE BOT ---
            // We get the query parameters from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            const firstName = urlParams.get('first_name');

            // Check if we received data
            if (userId && firstName) {
                displayDiv.innerHTML = `<b>Data received from bot:</b><br>User ID: ${userId}<br>First Name: ${firstName}`;
            } else {
                displayDiv.innerHTML = "<b>No data received from the bot.</b>";
            }
            
            // --- 2. SENDING DATA TO THE BOT ---
            const sendButton = document.getElementById('send-button');
            sendButton.addEventListener('click', function() {
                // This is the data we will send back to the bot
                const dataToSend = {
                    message: "Hello from the Web App!",
                    status: "ok"
                };

                // Use the sendData method to send data to the bot
                // The data must be a string, so we use JSON.stringify
                tg.sendData(JSON.stringify(dataToSend));
                
                // Optional: Close the web app after sending data
                // tg.close();
            });
        };
    </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const answersList = document.getElementById('answersList');
      const addAnswerBtn = document.getElementById('addAnswerBtn');
      const saveBtn = document.getElementById('saveBtn');
      const exitBtn = document.getElementById('exitBtn');
      
      // Auto-resize textareas
      function autoResize(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 240) + 'px';
      }
      
      // Initialize existing textareas
      document.querySelectorAll('.answer-input').forEach(autoResize);
      
      // Create a new answer item
      function createAnswer(value = '') {
        const li = document.createElement('li');
        li.className = 'answer-item';
        
        const span = document.createElement('span');
        span.className = 'answer-number';
        
        const textarea = document.createElement('textarea');
        textarea.className = 'answer-input';
        textarea.rows = 1;
        textarea.value = value;
        
        const actions = document.createElement('div');
        actions.className = 'answer-actions';
        
        const toggle = document.createElement('div');
        toggle.className = 'correct-toggle';
        toggle.innerHTML = '<div class="toggle-handle"></div>';
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-answer';
        removeBtn.type = 'button';
        removeBtn.title = 'Remove answer';
        removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
        
        actions.appendChild(toggle);
        actions.appendChild(removeBtn);
        li.appendChild(span);
        li.appendChild(textarea);
        li.appendChild(actions);
        
        // Set up event listeners for the new answer
        textarea.addEventListener('input', () => autoResize(textarea));
        toggle.addEventListener('click', () => setCorrect(li));
        removeBtn.addEventListener('click', () => removeAnswer(li));
        
        return li;
      }
      
      // Renumber all answers
      function renumberAnswers() {
        const items = answersList.children;
        for (let i = 0; i < items.length; i++) {
          const num = items[i].querySelector('.answer-number');
          num.textContent = i + 1;
        }
      }
      
      // Remove an answer
      function removeAnswer(answerItem) {
        answerItem.remove();
        renumberAnswers();
      }
      
      // Set correct answer
      function setCorrect(answerItem) {
        // Remove correct class from all answers
        document.querySelectorAll('.answer-item').forEach(item => {
          item.classList.remove('correct');
          item.querySelector('.correct-toggle').classList.remove('active');
        });
        
        // Add correct class to selected answer
        answerItem.classList.add('correct');
        answerItem.querySelector('.correct-toggle').classList.add('active');
      }
      
      // Add answer button event
      addAnswerBtn.addEventListener('click', () => {
        const newAnswer = createAnswer('');
        answersList.appendChild(newAnswer);
        renumberAnswers();
        newAnswer.querySelector('.answer-input').focus();
      });
      
      // Set up event listeners for existing answers
      answersList.querySelectorAll('.correct-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
          setCorrect(this.closest('.answer-item'));
        });
      });
      
      answersList.querySelectorAll('.remove-answer').forEach(button => {
        button.addEventListener('click', function() {
          removeAnswer(this.closest('.answer-item'));
        });
      });
      
      // Set up input event for all answer textareas
      answersList.querySelectorAll('.answer-input').forEach(textarea => {
        textarea.addEventListener('input', function() {
          autoResize(this);
        });
      });
      
      // Save button event
      saveBtn.addEventListener('click', () => {
        console.log('Exiting editor');
      });
      
      // Exit button event
      exitBtn.addEventListener('click', () => {
          console.log('Exiting editor');
          // In a real app, this would navigate away or close the editor
      });
    });
  </script>
</body>
</html>