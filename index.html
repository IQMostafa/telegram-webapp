<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Telegram Web App — debug</title>
  </head>
  <body>
    <h3>Telegram Web App — debug</h3>

    <div>
      <strong>navigator.userAgent:</strong>
      <pre id="ua">(checking...)</pre>
    </div>

    <div>
      <strong>window.Telegram exists?</strong>
      <pre id="tgExists">(checking...)</pre>
    </div>

    <div>
      <strong>window.Telegram.WebApp exists?</strong>
      <pre id="tgWebApp">(checking...)</pre>
    </div>

    <div>
      <strong>initDataUnsafe (parsed):</strong>
      <pre id="initUnsafe">(checking...)</pre>
    </div>

    <div>
      <strong>initData (signed string):</strong>
      <pre id="initSigned">(checking...)</pre>
    </div>

    <div>
      <label for="payload">Payload to send to bot:</label><br>
      <input id="payload" placeholder="type something to send">
      <button id="sendBtn">Send</button>
    </div>

    <script>
      const uaEl = document.getElementById('ua');
      const tgExistsEl = document.getElementById('tgExists');
      const tgWebAppEl = document.getElementById('tgWebApp');
      const initUnsafeEl = document.getElementById('initUnsafe');
      const initSignedEl = document.getElementById('initSigned');
      const sendBtn = document.getElementById('sendBtn');
      const payloadInput = document.getElementById('payload');

      uaEl.textContent = navigator.userAgent;

      const hasTelegram = !!(window.Telegram);
      tgExistsEl.textContent = String(hasTelegram);
      tgWebAppEl.textContent = String(!!(window.Telegram && window.Telegram.WebApp));

      if (hasTelegram && window.Telegram.WebApp) {
        try { window.Telegram.WebApp.expand(); } catch(e) {}
        const tg = window.Telegram.WebApp;
        initUnsafeEl.textContent = JSON.stringify(tg.initDataUnsafe || null, null, 2);
        initSignedEl.textContent = tg.initData || null;
      } else {
        initUnsafeEl.textContent = 'no initDataUnsafe (opened outside Telegram webview)';
        initSignedEl.textContent = 'no initData';
      }

      sendBtn.addEventListener('click', function() {
        const tg = window.Telegram && window.Telegram.WebApp;
        if (!tg) {
          alert('Cannot send: Telegram.WebApp not present (opened outside Telegram).');
          return;
        }
        const payload = payloadInput.value || 'hello from webapp';
        tg.sendData(JSON.stringify({payload: payload, time: new Date().toISOString()}));
      });
    </script>
  </body>
</html>
